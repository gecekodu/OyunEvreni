<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Besin Ninja: Mobil</title>
    <style>
        /* TEMEL AYARLAR */
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Segoe UI', sans-serif;
            background: #2c3e50;
            color: white;
            user-select: none;
            touch-action: none; /* Mobilde kaydƒ±rmayƒ± engeller */
        }

        /* --- YATAY EKRAN UYARISI --- */
        #rotate-warning {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #e74c3c;
            color: white;
            z-index: 9999;
            display: none; /* Ba≈ülangƒ±√ßta gizli, CSS ile y√∂netilecek */
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        
        /* Sadece Dƒ∞K (Portrait) modda uyarƒ±yƒ± g√∂ster */
        @media screen and (orientation: portrait) {
            #rotate-warning { display: flex; }
            #game-container { display: none; }
        }

        /* --- OYUN KAPLAYICISI --- */
        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }

        /* ORTAK ARAY√úZ STƒ∞LLERƒ∞ */
        .overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(44, 62, 80, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
            padding: 20px;
            box-sizing: border-box;
        }

        h1 { margin: 10px; color: #f39c12; font-size: 5vh; text-shadow: 2px 2px 0 #000; }
        p { font-size: 3vh; text-align: center; max-width: 80%; }

        .btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 4vh;
            border-radius: 50px;
            margin-top: 20px;
            cursor: pointer;
            box-shadow: 0 5px 0 #1e8449;
        }
        .btn:active { transform: translateY(5px); box-shadow: none; }

        /* TABLO (Mobilde k√º√ß√ºk g√∂r√ºnmesi i√ßin ayarlandƒ±) */
        .table-wrap {
            width: 90%;
            max-height: 50vh;
            overflow-y: auto;
            background: white;
            border-radius: 10px;
            color: #333;
            margin: 10px 0;
        }
        table { width: 100%; border-collapse: collapse; font-size: 2.5vh; }
        th, td { border: 1px solid #ccc; padding: 5px; text-align: center; }
        .th-c { background: #e67e22; color: white; }
        .th-p { background: #c0392b; color: white; }
        .th-y { background: #f1c40f; color: #333; }

        /* OYUN ƒ∞√áƒ∞ HUD */
        #hud {
            position: absolute;
            top: 0; left: 0; width: 100%;
            pointer-events: none;
            display: none;
            padding: 10px;
            box-sizing: border-box;
            display: flex;
            justify-content: space-between;
        }

        .hud-box {
            font-size: 4vh;
            font-weight: bold;
            text-shadow: 2px 2px 4px #000;
        }

        #target-display {
            position: absolute;
            top: 10%; width: 100%;
            text-align: center;
            font-size: 6vh;
            font-weight: bold;
            color: rgba(255,255,255,0.15);
            pointer-events: none;
            z-index: 1;
        }

        /* Geri Sayƒ±m Ekranƒ± */
        #round-screen { display: none; }
        .big-text { font-size: 8vh; color: #f1c40f; font-weight: bold; }

    </style>

    <style>
/* OYUN SONU MODAL STƒ∞LLERƒ∞ */
.gameOverModal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10000;
    opacity: 1;
    transition: opacity 0.3s ease;
}

.gameOverModal.hidden {
    display: none;
    opacity: 0;
}

.gameOverModalContent {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 20px;
    padding: 40px;
    text-align: center;
    color: white;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    max-width: 90%;
    animation: modalSlideIn 0.5s ease;
}

@keyframes modalSlideIn {
    from {
        transform: translateY(-50px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

.gameOverModalContent h2 {
    font-size: 28px;
    margin: 0 0 20px 0;
}

.gameOverInfo {
    background: rgba(255, 255, 255, 0.2);
    border-radius: 10px;
    padding: 20px;
    margin: 20px 0;
}

.gameOverInfo p {
    margin: 10px 0;
    font-size: 18px;
}

.earnedPoints {
    font-size: 20px;
    font-weight: bold;
    color: #ffd700;
}

#earnedPointsDisplay {
    font-size: 26px;
    font-weight: bold;
    color: #ffff00;
}

.gameOverBtn {
    background-color: white;
    color: #667eea;
    border: none;
    padding: 15px 40px;
    font-size: 18px;
    font-weight: bold;
    border-radius: 10px;
    cursor: pointer;
    margin-top: 10px;
    margin-left: 5px;
    margin-right: 5px;
    transition: all 0.3s ease;
    min-width: auto;
    flex: 1;
}

.gameOverBtn.primary {
    background: #10b981;
    color: white;
    border: 2px solid #10b981;
}

.gameOverBtn.secondary {
    background: transparent;
    color: #fff;
    border: 2px solid rgba(255,255,255,0.6);
}

.gameOverBtn:hover {
    transform: scale(1.05);
}

.gameOverBtn:active {
    transform: scale(0.95);
}

.gameOverBtnContainer {
    display: flex;
    gap: 10px;
    justify-content: center;
    flex-wrap: wrap;
    margin-top: 20px;
}
    </style>
</head>
<body>

    <div id="rotate-warning">
        <div style="font-size: 10vh;">üîÑ</div>
        <h1>L√ºtfen Ekranƒ± √áevirin</h1>
        <p>Bu oyun sadece yatay modda oynanabilir.</p>
    </div>

    <div id="game-container">
        
        <div id="start-screen" class="overlay">
            <h1>ü•ó Besin Ninja Mobil</h1>
            <p>3 Turda 100 puanƒ± topla! Her tur 20 saniye.</p>
            
            <div class="table-wrap">
                <table>
                    <thead>
                        <tr><th class="th-c">Karbonhidrat</th><th class="th-p">Protein</th><th class="th-y">Yaƒü</th></tr>
                    </thead>
                    <tbody id="data-table"></tbody>
                </table>
            </div>
            
            <button class="btn" onclick="initGame()">OYNA</button>
        </div>

        <div id="round-screen" class="overlay">
            <h2 style="font-size: 5vh; color:white;">TUR <span id="r-num">1</span></h2>
            <p>HEDEFƒ∞N:</p>
            <div class="big-text" id="r-target">PROTEƒ∞N</div>
            <div style="font-size: 10vh; margin-top:20px;" id="countdown">3</div>
        </div>

        <canvas id="canvas"></canvas>
        
        <div id="hud" style="display: none;">
            <div class="hud-box" style="color:#2ecc71;">SKOR: <span id="score-val">0</span>/100</div>
            <div class="hud-box" style="color:#e74c3c;">S√úRE: <span id="time-val">20</span></div>
        </div>
        <div id="target-display">HEDEF: ?</div>

        <div id="end-screen" class="overlay" style="display: none;">
            <h1>OYUN Bƒ∞TTƒ∞</h1>
            <div class="big-text" id="final-score">0</div>
            <p>Toplam Puan</p>
            <button class="btn" onclick="location.reload()">TEKRAR</button>
        </div>

    </div>

<script>
    // --- SES Sƒ∞STEMƒ∞ (AudioContext) ---
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    const audioCtx = new AudioContext();
    
    function playSound(type) {
        if(audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        const now = audioCtx.currentTime;

        if (type === 'cut') {
            osc.frequency.setValueAtTime(600, now);
            osc.frequency.exponentialRampToValueAtTime(100, now + 0.1);
            gain.gain.setValueAtTime(0.2, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
            osc.start(now); osc.stop(now + 0.1);
        } else if (type === 'good') {
            osc.type = 'sine';
            osc.frequency.setValueAtTime(1200, now);
            osc.frequency.exponentialRampToValueAtTime(1800, now + 0.15);
            gain.gain.setValueAtTime(0.3, now);
            gain.gain.linearRampToValueAtTime(0, now + 0.3);
            osc.start(now); osc.stop(now + 0.3);
        } else if (type === 'bad') {
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, now);
            osc.frequency.linearRampToValueAtTime(100, now + 0.3);
            gain.gain.setValueAtTime(0.3, now);
            gain.gain.linearRampToValueAtTime(0, now + 0.3);
            osc.start(now); osc.stop(now + 0.3);
        }
    }

    // --- VERƒ∞LER ---
    const dataSet = {
        'Karbonhidrat': [
            {n:'Ekmek', i:'üçû'}, {n:'Makarna', i:'üçù'}, {n:'Pirin√ß', i:'üçö'}, {n:'Patates', i:'ü•î'}, {n:'Muz', i:'üçå'},
            {n:'Bal', i:'üçØ'}, {n:'Yulaf', i:'üåæ'}, {n:'Mƒ±sƒ±r', i:'üåΩ'}, {n:'Elma', i:'üçé'}, {n:'Mercimek', i:'üç≤'}
        ],
        'Protein': [
            {n:'Yumurta', i:'ü•ö'}, {n:'Tavuk', i:'üçó'}, {n:'Et', i:'ü•©'}, {n:'Balƒ±k', i:'üêü'}, {n:'S√ºt', i:'ü•õ'},
            {n:'Yoƒüurt', i:'ü•£'}, {n:'Peynir', i:'üßÄ'}, {n:'Nohut', i:'üßÜ'}, {n:'Fasulye', i:'ü´ò'}, {n:'Badem', i:'ü•ú'}
        ],
        'Yaƒü': [
            {n:'Zeytinyaƒüƒ±', i:'ü´ó'}, {n:'Tereyaƒüƒ±', i:'üßà'}, {n:'Ay√ßi√ßek', i:'üåª'}, {n:'Avokado', i:'ü•ë'}, {n:'Ceviz', i:'üå∞'},
            {n:'Zeytin', i:'ü´í'}, {n:'Fƒ±ndƒ±k', i:'ü•ú'}, {n:'Susam', i:'ü•Ø'}, {n:'Mƒ±sƒ±r √ñz√º', i:'üü°'}, {n:'Kaymak', i:'üçÆ'}
        ]
    };

    // --- OYUN DEƒûƒ∞≈ûKENLERƒ∞ ---
    let canvas, ctx;
    let score = 0;
    let rounds = ['Karbonhidrat', 'Protein', 'Yaƒü'];
    let currentRoundIdx = 0;
    let currentTarget = '';
    let gameActive = false;
    let roundTime = 20;
    let timerInt;
    let isPaused = false;
    
    let foods = [];
    let particles = [];
    let touchPath = [];

    // --- BA≈ûLATMA ---
    window.onload = function() {
        canvas = document.getElementById('canvas');
        ctx = canvas.getContext('2d');
        resize();
        window.addEventListener('resize', resize);

        // Tabloyu Doldur
        const tb = document.getElementById('data-table');
        for(let i=0; i<10; i++) {
            tb.innerHTML += `<tr>
                <td>${dataSet['Karbonhidrat'][i].i} ${dataSet['Karbonhidrat'][i].n}</td>
                <td>${dataSet['Protein'][i].i} ${dataSet['Protein'][i].n}</td>
                <td>${dataSet['Yaƒü'][i].i} ${dataSet['Yaƒü'][i].n}</td>
            </tr>`;
        }

        // Dokunmatik ve Mouse Olaylarƒ±
        canvas.addEventListener('touchstart', handleStart, {passive: false});
        canvas.addEventListener('touchmove', handleMove, {passive: false});
        canvas.addEventListener('mousedown', handleStart);
        canvas.addEventListener('mousemove', handleMove);
        // Dokunma bitince yolu temizle
        canvas.addEventListener('touchend', () => touchPath = []);
        canvas.addEventListener('mouseup', () => touchPath = []);
    };

    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }

    function initGame() {
        // Ses kilidini a√ß
        if(audioCtx.state === 'suspended') audioCtx.resume();

        // Tam ekran isteƒüi (Opsiyonel, tarayƒ±cƒ± izin verirse)
        if (document.documentElement.requestFullscreen) {
            document.documentElement.requestFullscreen().catch(err => {});
        }

        rounds.sort(() => Math.random() - 0.5); // Turlarƒ± karƒ±≈ütƒ±r
        currentRoundIdx = 0;
        score = 0;
        document.getElementById('start-screen').style.display = 'none';
        
        startRoundSequence();
        requestAnimationFrame(loop);
    }

    // --- TUR Sƒ∞STEMƒ∞ ---
    function startRoundSequence() {
        gameActive = false;
        foods = [];
        touchPath = [];
        
        if (currentRoundIdx >= 3) {
            endGame();
            return;
        }

        currentTarget = rounds[currentRoundIdx];
        
        // Ara Ekran Ayarlarƒ±
        const rScreen = document.getElementById('round-screen');
        document.getElementById('hud').style.display = 'none';
        rScreen.style.display = 'flex';
        
        document.getElementById('r-num').innerText = currentRoundIdx + 1;
        const tTxt = document.getElementById('r-target');
        tTxt.innerText = currentTarget.toUpperCase();
        
        if(currentTarget === 'Karbonhidrat') tTxt.style.color = '#e67e22';
        else if(currentTarget === 'Protein') tTxt.style.color = '#c0392b';
        else tTxt.style.color = '#f1c40f';

        // Geri Sayƒ±m
        let c = 3;
        document.getElementById('countdown').innerText = c;
        let cInt = setInterval(() => {
            if (isPaused) return;
            c--;
            if(c > 0) document.getElementById('countdown').innerText = c;
            else {
                clearInterval(cInt);
                rScreen.style.display = 'none';
                startRoundPlay();
            }
        }, 1000);
    }

    function startRoundPlay() {
        gameActive = true;
        document.getElementById('hud').style.display = 'flex';
        document.getElementById('target-display').innerText = currentTarget;
        
        roundTime = 20;
        document.getElementById('time-val').innerText = roundTime;
        
        if(timerInt) clearInterval(timerInt);
        timerInt = setInterval(() => {
            if(!gameActive || isPaused) return;
            roundTime--;
            document.getElementById('time-val').innerText = roundTime;
            if(roundTime <= 0) {
                clearInterval(timerInt);
                currentRoundIdx++;
                startRoundSequence();
            }
        }, 1000);
    }

    // --- OYUN NESNELERƒ∞ ---
    class Food {
        constructor() {
            // Hedef gelme ≈üansƒ± %50
            const isT = Math.random() < 0.5;
            this.cat = isT ? currentTarget : rounds[Math.floor(Math.random()*3)];
            
            const list = dataSet[this.cat];
            const item = list[Math.floor(Math.random()*list.length)];
            
            this.name = item.n;
            this.icon = item.i;
            
            // Fizik
            this.x = Math.random() * (canvas.width - 100) + 50;
            this.y = canvas.height + 100;
            // Mobilde ekran boyutuna g√∂re hƒ±z ayarla
            this.vx = (Math.random() - 0.5) * (canvas.width * 0.005); 
            this.vy = -(Math.random() * (canvas.height * 0.01) + (canvas.height * 0.015)); 
            
            this.r = canvas.height * 0.08; // Yarƒ±√ßap ekrana g√∂re deƒüi≈üsin
            this.angle = 0;
            this.spin = (Math.random() - 0.5) * 0.1;
            this.sliced = false;
        }
        update() {
            this.x += this.vx;
            this.y += this.vy;
            this.vy += canvas.height * 0.0002; // Yer√ßekimi
            this.angle += this.spin;
        }
        draw() {
            ctx.save();
            ctx.translate(this.x, this.y);
            ctx.rotate(this.angle);
            
            ctx.shadowBlur = 15;
            ctx.shadowColor = "white";
            
            // Emoji Boyutu
            ctx.font = (this.r * 2) + "px Arial";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillText(this.icon, 0, 0);
            
            // Yazƒ±
            ctx.shadowBlur = 0;
            ctx.fillStyle = "white";
            ctx.font = "bold " + (this.r * 0.4) + "px Arial";
            ctx.strokeText(this.name, 0, this.r);
            ctx.fillText(this.name, 0, this.r);
            
            ctx.restore();
        }
    }

    class Particle {
        constructor(x, y, color) {
            this.x = x; this.y = y;
            this.vx = (Math.random()-0.5)*10;
            this.vy = (Math.random()-0.5)*10;
            this.life = 1; 
            this.c = color;
        }
        update() { this.x+=this.vx; this.y+=this.vy; this.life-=0.05; }
        draw() {
            ctx.globalAlpha = this.life;
            ctx.fillStyle = this.c;
            ctx.beginPath();
            ctx.arc(this.x, this.y, 5, 0, Math.PI*2);
            ctx.fill();
            ctx.globalAlpha = 1;
        }
    }

    // --- KONTROL (TOUCH & MOUSE) ---
    function handleStart(e) {
        e.preventDefault(); // Kaydƒ±rmayƒ± engelle
        touchPath = [];
        addPoint(e);
    }
    
    function handleMove(e) {
        e.preventDefault();
        if(e.type === 'mousemove' && e.buttons !== 1) return;
        addPoint(e);
    }

    function addPoint(e) {
        let x, y;
        if(e.touches) {
            x = e.touches[0].clientX;
            y = e.touches[0].clientY;
        } else {
            x = e.clientX;
            y = e.clientY;
        }
        touchPath.push({x, y});
        if(touchPath.length > 8) touchPath.shift();
        checkCut(x, y);
    }

    function checkCut(mx, my) {
        if(!gameActive) return;
        for(let i=foods.length-1; i>=0; i--) {
            let f = foods[i];
            let dist = Math.sqrt((mx-f.x)**2 + (my-f.y)**2);
            if(dist < f.r && !f.sliced) {
                slice(i);
            }
        }
    }

    function slice(idx) {
        let f = foods[idx];
        f.sliced = true;
        playSound('cut');
        
        let col = '#fff';
        if(f.cat === 'Karbonhidrat') col = '#e67e22';
        else if(f.cat === 'Protein') col = '#c0392b';
        else col = '#f1c40f';
        
        for(let k=0; k<10; k++) particles.push(new Particle(f.x, f.y, col));

        if(f.cat === currentTarget) {
            score = Math.min(score + 5, 100); // Max 100
            playSound('good');
        } else {
            score = Math.max(score - 5, 0);
            playSound('bad');
        }
        
        document.getElementById('score-val').innerText = score;
        foods.splice(idx, 1);
    }

    function endGame() {
        gameActive = false;
        clearInterval(timerInt);
        document.getElementById('hud').style.display = 'none';
        // Modal g√∂ster - puan ekranƒ± yerine
        showGameOverModal(score, 'üéâ Oyunu ba≈üarƒ±yla tamamladƒ±n!');
    }

    // --- LOOP ---
    let frame = 0;
    function loop() {
        if (isPaused) {
            requestAnimationFrame(loop);
            return;
        }
        ctx.clearRect(0,0, canvas.width, canvas.height);
        
        if(gameActive) {
            frame++;
            if(frame % 60 === 0) foods.push(new Food()); // Saniyede 1 (approx)
            
            for(let i=foods.length-1; i>=0; i--) {
                foods[i].update();
                foods[i].draw();
                if(foods[i].y > canvas.height + 200) foods.splice(i,1);
            }
            
            // Bƒ±√ßak ƒ∞zi
            if(touchPath.length > 1) {
                ctx.beginPath();
                ctx.strokeStyle = "cyan";
                ctx.lineWidth = 5;
                ctx.lineCap = "round";
                ctx.moveTo(touchPath[0].x, touchPath[0].y);
                for(let p of touchPath) ctx.lineTo(p.x, p.y);
                ctx.stroke();
            }
        }
        
        for(let i=particles.length-1; i>=0; i--) {
            particles[i].update();
            particles[i].draw();
            if(particles[i].life <= 0) particles.splice(i,1);
        }
        
        requestAnimationFrame(loop);
    }

</script>
<script>
/* OYUN SONU FONKSIYONLARI */
function showGameOverModal(puanKazandigi, aciklama) {
    aciklama = aciklama || 'Oyunu tamamladƒ±n!';
    const modal = document.getElementById('gameOverModal');
    if (modal) {
        document.getElementById('gameOverTitle').textContent = 'üéÆ Oyun Bitti!';
        document.getElementById('gameOverMessage').textContent = aciklama;
        document.getElementById('earnedPointsDisplay').textContent = puanKazandigi;
        modal.classList.remove('hidden');
    }
    oyunBitti(puanKazandigi);
}

function closeGameOverModal() {
    const modal = document.getElementById('gameOverModal');
    if (modal) {
        modal.classList.add('hidden');
    }
}

function restartGameFromModal() {
    closeGameOverModal();
    location.reload();
}

function oyunBitti(puan) {
    console.log('üéØ Oyun sonu puanƒ±: ' + puan);
    
    // ‚úÖ Flutter'a puan g√∂nder
    if (window.flutter_inappwebview && typeof window.flutter_inappwebview.callHandler === 'function') {
        window.flutter_inappwebview.callHandler('sendScore', puan);
        console.log('‚úÖ Puan Flutter\'e g√∂nderildi: ' + puan);
    }
    
    // Fallback: Eski y√∂ntemler
    if (window.PuanKanali) {
        window.PuanKanali.postMessage(puan.toString());
    }

    if (window.GameBridge && typeof window.GameBridge.sendScore === 'function') {
        window.GameBridge.sendScore(puan, { source: 'gameOver' });
    }

    if (window.sendBadgeForScore) {
        window.sendBadgeForScore(puan);
    }
}

function collectScoreAndExit(puan) {
    console.log('üíæ Puan kabul ediliyor ve oyundan √ßƒ±kƒ±lƒ±yor: ' + puan);
    
    // Ensure score is sent to Flutter
    if (window.flutter_inappwebview && typeof window.flutter_inappwebview.callHandler === 'function') {
        window.flutter_inappwebview.callHandler('sendScore', puan);
        console.log('‚úÖ Puan Flutter\'e g√∂nderildi: ' + puan);
    }
    
    // Close the game and return to app
    if (window.GameBridge && window.GameBridge.backToApp) {
        window.GameBridge.backToApp();
    } else {
        // Fallback - just navigate back
        history.back();
    }
}

document.addEventListener('DOMContentLoaded', function() {
    const collectScoreBtn = document.getElementById('collectScoreBtn');
    const playAgainBtn = document.getElementById('playAgainBtn');
    const exitBtn = document.getElementById('exitBtn');
    
    if (collectScoreBtn) {
        collectScoreBtn.addEventListener('click', function () {
            const earnedPoints = parseInt(document.getElementById('earnedPointsDisplay').textContent || '0');
            collectScoreAndExit(earnedPoints);
        });
    }
    
    if (playAgainBtn) {
        playAgainBtn.addEventListener('click', restartGameFromModal);
    }
    
    if (exitBtn) {
        exitBtn.addEventListener('click', function () {
            if (window.GameBridge && window.GameBridge.backToApp) {
                window.GameBridge.backToApp();
            }
        });
    }
});
</script>

    <!-- Game Over Modal -->
    <div id="gameOverModal" class="gameOverModal hidden">
        <div class="gameOverModalContent">
            <h2 id="gameOverTitle">üéÆ Oyun Bitti!</h2>
            <div class="gameOverInfo">
                <p id="gameOverMessage">Oyunu tamamladƒ±n!</p>
                <p class="earnedPoints">Kazandƒ±ƒüƒ±n Puan: <span id="earnedPointsDisplay">0</span></p>
            </div>
            <div class="gameOverBtnContainer">
                <button id="collectScoreBtn" class="gameOverBtn primary">‚úÖ Puanƒ± Al</button>
                <button id="playAgainBtn" class="gameOverBtn">Tekrar Oyna üîÅ</button>
                <button id="exitBtn" class="gameOverBtn secondary">Ana Menu</button>
            </div>
        </div>
    </div>

    <div id="app-controls" class="app-controls">
        <button id="app-back" class="app-ctrl-btn" type="button">‚üµ</button>
        <button id="app-pause" class="app-ctrl-btn" type="button">‚è∏</button>
        <button id="app-full" class="app-ctrl-btn" type="button">‚õ∂</button>
    </div>

    <div id="pause-overlay" class="pause-overlay hidden">
        <div class="pause-card">
            <h3>Oyun Duraklatildi</h3>
            <button id="pause-resume" class="pause-btn">Devam Et</button>
            <button id="pause-home" class="pause-btn secondary">Ana Menu</button>
        </div>
    </div>

    <div id="badge-toast" class="badge-toast hidden">
        <div class="badge-icon">üèÖ</div>
        <div class="badge-text">
            <div class="badge-title">Rozet Kazandin!</div>
            <div class="badge-name" id="badge-name">Rozet</div>
        </div>
    </div>

    <style>
        .app-controls {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 10001;
            display: flex;
            gap: 8px;
        }
        .app-ctrl-btn {
            background: rgba(0, 0, 0, 0.6);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.35);
            border-radius: 10px;
            padding: 10px 12px;
            font-size: 16px;
            cursor: pointer;
        }
        .app-ctrl-btn:active { transform: scale(0.96); }
        .pause-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10002;
        }
        .pause-overlay.hidden { display: none; }
        .pause-card {
            background: rgba(20, 20, 20, 0.95);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 16px;
            padding: 20px 24px;
            color: #fff;
            text-align: center;
            width: 80%;
            max-width: 320px;
        }
        .pause-btn {
            margin-top: 12px;
            width: 100%;
            padding: 10px 12px;
            border-radius: 10px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            background: #27ae60;
            color: #fff;
        }
        .pause-btn.secondary { background: #34495e; }
        .badge-toast {
            position: fixed;
            left: 16px;
            bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 14px;
            border-radius: 14px;
            background: rgba(15, 15, 20, 0.9);
            color: #fff;
            border: 1px solid rgba(255, 215, 0, 0.6);
            box-shadow: 0 10px 25px rgba(0,0,0,0.35);
            z-index: 10003;
            transform: translateY(20px);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        .badge-toast.show {
            transform: translateY(0);
            opacity: 1;
        }
        .badge-toast.hidden { display: none; }
        .badge-icon { font-size: 22px; }
        .badge-title { font-size: 12px; color: #ffd966; font-weight: bold; }
        .badge-name { font-size: 14px; font-weight: bold; }
    </style>

    <script>
        (function () {
            function postUi(payload) {
                if (window.GameUi && window.GameUi.postMessage) {
                    window.GameUi.postMessage(JSON.stringify(payload));
                    return true;
                }
                return false;
            }

            function setFullscreen(next) {
                postUi({ type: next ? 'enterFullscreen' : 'exitFullscreen' });
            }

            window.GameBridge = {
                backToApp: function () { postUi({ type: 'back' }); },
                enterFullscreen: function () { setFullscreen(true); },
                exitFullscreen: function () { setFullscreen(false); },
                requestAppData: function () { postUi({ type: 'requestAppData' }); },
                sendEvent: function (event, data) { postUi({ type: 'event', event: event, data: data || {} }); },
                sendScore: function (score, meta) { postUi({ type: 'score', score: Number(score) || 0, meta: meta || {} }); },
            };

            var fullBtn = document.getElementById('app-full');
            var backBtn = document.getElementById('app-back');
            var pauseBtn = document.getElementById('app-pause');
            var pauseOverlay = document.getElementById('pause-overlay');
            var pauseResume = document.getElementById('pause-resume');
            var pauseHome = document.getElementById('pause-home');
            var isFull = false;
            var isPausedLocal = false;

            function setPaused(next) {
                isPausedLocal = next;
                isPaused = next;
                if (pauseOverlay) {
                    pauseOverlay.classList.toggle('hidden', !next);
                }
                if (pauseBtn) {
                    pauseBtn.textContent = next ? '‚ñ∂' : '‚è∏';
                }
            }

            function showBadgeToast(badge) {
                var toast = document.getElementById('badge-toast');
                var nameEl = document.getElementById('badge-name');
                if (!toast || !nameEl || !badge) return;
                nameEl.textContent = badge.name || 'Rozet';
                toast.classList.remove('hidden');
                toast.classList.add('show');
                setTimeout(function () {
                    toast.classList.remove('show');
                }, 1800);
                setTimeout(function () {
                    toast.classList.add('hidden');
                }, 2100);
            }

            window.sendBadgeForScore = function (score) {
                var badge = null;
                if (score >= 90) badge = { id: 'besin-ninja-ustasi', name: 'Besin Ninja Ustasi', desc: '90+ puan' };
                else if (score >= 70) badge = { id: 'besin-ninja-gumus', name: 'Besin Ninja Gumus', desc: '70+ puan' };
                else if (score >= 40) badge = { id: 'besin-ninja-bronz', name: 'Besin Ninja Bronz', desc: '40+ puan' };
                if (badge && window.GameBridge && window.GameBridge.sendEvent) {
                    showBadgeToast(badge);
                    window.GameBridge.sendEvent('badge', badge);
                }
            };

            if (backBtn) backBtn.addEventListener('click', function () { window.GameBridge.backToApp(); });
            if (fullBtn) fullBtn.addEventListener('click', function () {
                isFull = !isFull;
                fullBtn.textContent = isFull ? '‚§°' : '‚õ∂';
                if (isFull) window.GameBridge.enterFullscreen();
                else window.GameBridge.exitFullscreen();
            });
            if (pauseBtn) pauseBtn.addEventListener('click', function () { setPaused(!isPausedLocal); });
            if (pauseResume) pauseResume.addEventListener('click', function () { setPaused(false); });
            if (pauseHome) pauseHome.addEventListener('click', function () { window.GameBridge.backToApp(); });

            document.addEventListener('keydown', function (e) {
                if (e.key === 'Escape') window.GameBridge.backToApp();
                if (e.key && e.key.toLowerCase() === 'f' && fullBtn) fullBtn.click();
                if (e.key && e.key.toLowerCase() === 'p' && pauseBtn) pauseBtn.click();
            });

            window.onAppData = function (dataJson) {
                try { window.__appData = JSON.parse(dataJson); } catch (e) {}
            };

            document.addEventListener('DOMContentLoaded', function () {
                window.GameBridge.requestAppData();
                window.GameBridge.sendEvent('ready', { title: document.title });
            });
        })();
    </script>

</body>
</html>